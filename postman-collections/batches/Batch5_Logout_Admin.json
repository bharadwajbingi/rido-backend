{
  "info": {
    "_postman_id": "rido-batch-5",
    "name": "Rido Tests - Batch5_Logout_Admin",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080"
    },
    {
      "key": "admin_url",
      "value": "http://localhost:9091"
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "refresh_token",
      "value": ""
    },
    {
      "key": "admin_token",
      "value": ""
    },
    {
      "key": "user_id",
      "value": ""
    },
    {
      "key": "test_user",
      "value": ""
    },
    {
      "key": "test_pass",
      "value": "TestPass123!"
    },
    {
      "key": "session_id",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "06-Logout (15 tests)",
      "item": [
        {
          "name": "[+] Re-login for logout",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/login",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"{{test_user}}\",\"password\":\"{{test_pass}}\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var j=pm.response.json();pm.collectionVariables.set('token',j.accessToken);pm.collectionVariables.set('refresh_token',j.refreshToken);pm.test('200',()=>pm.response.to.have.status(200));"
                ]
              }
            }
          ]
        },
        {
          "name": "[+] Valid logout",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"{{refresh_token}}\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('200',()=>pm.response.to.have.status(200));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout no refresh token",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout invalid refresh",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"invalid\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout empty refresh",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 1",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_1\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 2",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_2\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 3",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_3\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 4",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_4\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 5",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_5\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 6",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_6\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 7",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_7\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 8",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_8\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 9",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_9\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Logout random token 10",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"logout_invalid_10\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "07-Admin (25 tests)",
      "item": [
        {
          "name": "[+] Admin health",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/health",
            "header": []
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('200',()=>pm.response.to.have.status(200));"
                ]
              }
            }
          ]
        },
        {
          "name": "[+] Health has status",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/health",
            "header": []
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('hasStatus',()=>pm.expect(pm.response.json().status).to.exist);"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin login wrong pass",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/login",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"admin\",\"password\":\"wrong\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin login empty",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/login",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('400',()=>pm.expect([400,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin login missing user",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/login",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"password\":\"test\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('400',()=>pm.expect([400,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin login missing pass",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/login",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"admin\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('400',()=>pm.expect([400,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[~] Audit logs (skip if no token)",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs?page=0&size=10",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if(!pm.collectionVariables.get('admin_token')){pm.test('skip',()=>true);return;}pm.test('200',()=>pm.response.to.have.status(200));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Audit no auth",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": []
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401|403',()=>pm.expect([401,403]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Audit invalid token",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[~] Create admin (skip)",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/create",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"newadmin_1764838059623\",\"password\":\"Admin123!\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if(!pm.collectionVariables.get('admin_token')){pm.test('skip',()=>true);return;}pm.test('200',()=>pm.response.to.have.status(200));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Create no auth",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/create",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"test\",\"password\":\"Admin123!\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Create invalid token",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/create",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer invalid"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"test\",\"password\":\"Admin123!\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[~] Key rotate (skip)",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/key/rotate",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if(!pm.collectionVariables.get('admin_token')){pm.test('skip',()=>true);return;}pm.test('200',()=>pm.response.to.have.status(200));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Rotate no auth",
          "request": {
            "method": "POST",
            "url": "{{admin_url}}/admin/key/rotate",
            "header": []
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 1",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_1"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 2",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_2"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 3",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_3"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 4",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_4"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 5",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_5"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 6",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_6"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 7",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_7"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 8",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_8"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 9",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_9"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 10",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_10"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        },
        {
          "name": "[-] Admin random token 11",
          "request": {
            "method": "GET",
            "url": "{{admin_url}}/admin/audit/logs",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer admin_invalid_11"
              }
            ]
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('401',()=>pm.expect([401,423]).to.include(pm.response.code));"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}