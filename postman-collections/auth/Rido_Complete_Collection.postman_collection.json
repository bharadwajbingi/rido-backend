{
  "info": {
    "_postman_id": "rido-complete-collection-v1",
    "name": "Rido Microservices - Complete Test Suite",
    "description": "Comprehensive API test collection for Auth, Gateway, and Profile services with positive and negative test cases.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {"key": "auth_base_url", "value": "http://localhost:8080"},
    {"key": "admin_base_url", "value": "http://localhost:9091"},
    {"key": "gateway_base_url", "value": "http://localhost:8080"},
    {"key": "auth_token", "value": ""},
    {"key": "admin_token", "value": ""},
    {"key": "refresh_token", "value": ""},
    {"key": "user_id", "value": ""},
    {"key": "test_username", "value": ""},
    {"key": "test_password", "value": "TestPass123!"},
    {"key": "device_id", "value": "postman-device-001"},
    {"key": "session_id", "value": ""}
  ],
  "item": [
    {
      "name": "01 - Auth Service",
      "item": [
        {
          "name": "01.1 - Registration",
          "item": [
            {
              "name": "[P] Valid Registration",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": ["pm.collectionVariables.set('test_username', 'user_' + Date.now());"]
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "pm.test('Status OK', () => pm.expect(pm.response.json().status).to.eql('ok'));"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"{{test_username}}\", \"password\": \"{{test_password}}\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[P] Username Min Boundary (3 chars)",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"u\" + Date.now().toString().slice(-2), \"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Missing Username",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Missing Password",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"testuser\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Empty Username",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"\", \"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Password Too Short",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"testuser\", \"password\": \"12345\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Username Too Short",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"ab\", \"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Duplicate Username",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 409', () => pm.response.to.have.status(409));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"{{test_username}}\", \"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Invalid JSON",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{invalid json}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            },
            {
              "name": "[N] Null Character in Username",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"test\\u0000user\", \"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/register"
              }
            }
          ]
        },
        {
          "name": "01.2 - Login",
          "item": [
            {
              "name": "[P] Valid Login",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "const json = pm.response.json();",
                      "pm.test('Has accessToken', () => pm.expect(json.accessToken).to.be.a('string'));",
                      "pm.test('Has refreshToken', () => pm.expect(json.refreshToken).to.be.a('string'));",
                      "pm.test('Has expiresIn', () => pm.expect(json.expiresIn).to.be.a('number'));",
                      "pm.collectionVariables.set('auth_token', json.accessToken);",
                      "pm.collectionVariables.set('refresh_token', json.refreshToken);"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Content-Type", "value": "application/json"},
                  {"key": "X-Device-Id", "value": "{{device_id}}"}
                ],
                "body": {"mode": "raw", "raw": "{\"username\": \"{{test_username}}\", \"password\": \"{{test_password}}\"}"},
                "url": "{{auth_base_url}}/auth/login"
              }
            },
            {
              "name": "[N] Wrong Password",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"{{test_username}}\", \"password\": \"wrongpass\"}"},
                "url": "{{auth_base_url}}/auth/login"
              }
            },
            {
              "name": "[N] Non-existent User",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"nonexistent_user_xyz\", \"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/login"
              }
            },
            {
              "name": "[N] Missing Username",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"password\": \"TestPass123!\"}"},
                "url": "{{auth_base_url}}/auth/login"
              }
            },
            {
              "name": "[N] Missing Password",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"username\": \"{{test_username}}\"}"},
                "url": "{{auth_base_url}}/auth/login"
              }
            },
            {
              "name": "[N] Empty Body",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{}"},
                "url": "{{auth_base_url}}/auth/login"
              }
            }
          ]
        },
        {
          "name": "01.3 - Token Refresh",
          "item": [
            {
              "name": "[P] Valid Refresh",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "const json = pm.response.json();",
                      "pm.test('Has new accessToken', () => pm.expect(json.accessToken).to.be.a('string'));",
                      "pm.collectionVariables.set('auth_token', json.accessToken);",
                      "if(json.refreshToken) pm.collectionVariables.set('refresh_token', json.refreshToken);"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Content-Type", "value": "application/json"},
                  {"key": "X-Device-Id", "value": "{{device_id}}"}
                ],
                "body": {"mode": "raw", "raw": "{\"refreshToken\": \"{{refresh_token}}\"}"},
                "url": "{{auth_base_url}}/auth/refresh"
              }
            },
            {
              "name": "[N] Missing Refresh Token",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{}"},
                "url": "{{auth_base_url}}/auth/refresh"
              }
            },
            {
              "name": "[N] Invalid Refresh Token",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"refreshToken\": \"invalid-token-here\"}"},
                "url": "{{auth_base_url}}/auth/refresh"
              }
            },
            {
              "name": "[N] Null Refresh Token",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"refreshToken\": null}"},
                "url": "{{auth_base_url}}/auth/refresh"
              }
            }
          ]
        },
        {
          "name": "01.4 - Protected Endpoints",
          "item": [
            {
              "name": "[P] Get Current User /me",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "const json = pm.response.json();",
                      "pm.test('Has id', () => pm.expect(json.id).to.be.a('string'));",
                      "pm.test('Has username', () => pm.expect(json.username).to.be.a('string'));",
                      "pm.collectionVariables.set('user_id', json.id);"
                    ]
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{auth_base_url}}/auth/me"
              }
            },
            {
              "name": "[N] /me Without Auth",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "GET",
                "header": [],
                "url": "{{auth_base_url}}/auth/me"
              }
            },
            {
              "name": "[N] /me With Invalid Token",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "GET",
                "header": [{"key": "Authorization", "value": "Bearer invalid.token.here"}],
                "url": "{{auth_base_url}}/auth/me"
              }
            },
            {
              "name": "[P] Get Sessions",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "pm.test('Is array', () => pm.expect(pm.response.json()).to.be.an('array'));",
                      "const sessions = pm.response.json();",
                      "if(sessions.length > 0) pm.collectionVariables.set('session_id', sessions[0].id);"
                    ]
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{auth_base_url}}/auth/sessions"
              }
            },
            {
              "name": "[N] Sessions Without Auth",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "GET",
                "header": [],
                "url": "{{auth_base_url}}/auth/sessions"
              }
            },
            {
              "name": "[P] Secure Info",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "pm.test('Has userId', () => pm.expect(pm.response.json().userId).to.be.a('string'));",
                      "pm.test('Has roles', () => pm.expect(pm.response.json().roles).to.be.an('array'));"
                    ]
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{auth_base_url}}/secure/info"
              }
            }
          ]
        },
        {
          "name": "01.5 - JWKS",
          "item": [
            {
              "name": "[P] Get JWKS",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "pm.test('Has keys array', () => pm.expect(pm.response.json().keys).to.be.an('array'));",
                      "pm.test('Key has kid', () => pm.expect(pm.response.json().keys[0].kid).to.be.a('string'));"
                    ]
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": "{{auth_base_url}}/auth/keys/jwks.json"
              }
            },
            {
              "name": "[P] Get Well-Known JWKS",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "GET",
                "header": [],
                "url": "{{auth_base_url}}/auth/keys/.well-known/jwks.json"
              }
            }
          ]
        },
        {
          "name": "01.6 - Logout",
          "item": [
            {
              "name": "[P] Valid Logout",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Content-Type", "value": "application/json"},
                  {"key": "Authorization", "value": "Bearer {{auth_token}}"}
                ],
                "body": {"mode": "raw", "raw": "{\"refreshToken\": \"{{refresh_token}}\"}"},
                "url": "{{auth_base_url}}/auth/logout"
              }
            },
            {
              "name": "[N] Logout Missing Refresh Token",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{}"},
                "url": "{{auth_base_url}}/auth/logout"
              }
            }
          ]
        },
        {
          "name": "01.7 - Check Username",
          "item": [
            {
              "name": "[P] Check Available Username",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "pm.test('Available true', () => pm.expect(pm.response.json().available).to.be.true);"
                    ]
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {"raw": "{{auth_base_url}}/auth/check-username?username=newuser123", "host": ["{{auth_base_url}}"], "path": ["auth", "check-username"], "query": [{"key": "username", "value": "newuser123"}]}
              }
            },
            {
              "name": "[P] Check Taken Username",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "GET",
                "header": [],
                "url": {"raw": "{{auth_base_url}}/auth/check-username?username={{test_username}}", "host": ["{{auth_base_url}}"], "path": ["auth", "check-username"], "query": [{"key": "username", "value": "{{test_username}}"}]}
              }
            }
          ]
        }
      ]
    },
    {
      "name": "02 - Admin Service (Port 9091)",
      "item": [
        {
          "name": "[P] Admin Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "pm.test('Status UP', () => pm.expect(pm.response.json().status).to.eql('UP'));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{admin_base_url}}/admin/health"
          }
        },
        {
          "name": "[P] Admin Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "const json = pm.response.json();",
                  "if(json.accessToken) pm.collectionVariables.set('admin_token', json.accessToken);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"username\": \"admin\", \"password\": \"adminpass\"}"},
            "url": "{{admin_base_url}}/admin/login"
          }
        },
        {
          "name": "[N] Admin Login Wrong Password",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"username\": \"admin\", \"password\": \"wrongpass\"}"},
            "url": "{{admin_base_url}}/admin/login"
          }
        },
        {
          "name": "[N] Admin Login Missing Fields",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{}"},
            "url": "{{admin_base_url}}/admin/login"
          }
        },
        {
          "name": "[P] Get Audit Logs",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{admin_token}}"}],
            "url": {"raw": "{{admin_base_url}}/admin/audit/logs?page=0&size=10", "host": ["{{admin_base_url}}"], "path": ["admin", "audit", "logs"], "query": [{"key": "page", "value": "0"}, {"key": "size", "value": "10"}]}
          }
        },
        {
          "name": "[N] Audit Logs Without Auth",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401 or 403', () => pm.expect([401,403]).to.include(pm.response.code));"]}}],
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{admin_base_url}}/admin/audit/logs"
          }
        },
        {
          "name": "[P] Create Admin",
          "event": [
            {
              "listen": "prerequest",
              "script": {"exec": ["pm.collectionVariables.set('new_admin', 'admin_' + Date.now());"]}
            },
            {"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{admin_token}}"}
            ],
            "body": {"mode": "raw", "raw": "{\"username\": \"{{new_admin}}\", \"password\": \"NewAdmin123!\"}"},
            "url": "{{admin_base_url}}/admin/create"
          }
        },
        {
          "name": "[N] Create Admin Without Auth",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"username\": \"newadmin\", \"password\": \"NewAdmin123!\"}"},
            "url": "{{admin_base_url}}/admin/create"
          }
        },
        {
          "name": "[P] Rotate Keys",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has newKid', () => pm.expect(pm.response.json().newKid).to.be.a('string'));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{admin_token}}"}],
            "url": "{{admin_base_url}}/admin/key/rotate"
          }
        },
        {
          "name": "[N] Rotate Keys Without Auth",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
          "request": {
            "method": "POST",
            "header": [],
            "url": "{{admin_base_url}}/admin/key/rotate"
          }
        }
      ]
    },
    {
      "name": "03 - Profile Service (via Gateway)",
      "item": [
        {
          "name": "03.1 - Profile Management",
          "item": [
            {
              "name": "[P] Get My Profile",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "GET",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{gateway_base_url}}/profile/me"
              }
            },
            {
              "name": "[N] Get Profile Without Auth",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "GET",
                "header": [],
                "url": "{{gateway_base_url}}/profile/me"
              }
            },
            {
              "name": "[P] Update Profile",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "PUT",
                "header": [
                  {"key": "Authorization", "value": "Bearer {{auth_token}}"},
                  {"key": "Content-Type", "value": "application/json"}
                ],
                "body": {"mode": "raw", "raw": "{\"name\": \"Updated Name\", \"email\": \"updated@example.com\"}"},
                "url": "{{gateway_base_url}}/profile/me"
              }
            },
            {
              "name": "[N] Update Profile Without Auth",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
              "request": {
                "method": "PUT",
                "header": [{"key": "Content-Type", "value": "application/json"}],
                "body": {"mode": "raw", "raw": "{\"name\": \"Test\"}"},
                "url": "{{gateway_base_url}}/profile/me"
              }
            },
            {
              "name": "[P] Generate Photo Upload URL",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{gateway_base_url}}/profile/me/photo"
              }
            }
          ]
        },
        {
          "name": "03.2 - Rider Addresses",
          "item": [
            {
              "name": "[P] Get Addresses",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "GET",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{gateway_base_url}}/profile/rider/addresses"
              }
            },
            {
              "name": "[P] Add Address",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 201', () => pm.response.to.have.status(201));",
                      "if(pm.response.json().id) pm.collectionVariables.set('address_id', pm.response.json().id);"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Authorization", "value": "Bearer {{auth_token}}"},
                  {"key": "Content-Type", "value": "application/json"}
                ],
                "body": {"mode": "raw", "raw": "{\"label\": \"Home\", \"lat\": 12.9716, \"lng\": 77.5946}"},
                "url": "{{gateway_base_url}}/profile/rider/addresses"
              }
            },
            {
              "name": "[N] Add Address Missing Label",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Authorization", "value": "Bearer {{auth_token}}"},
                  {"key": "Content-Type", "value": "application/json"}
                ],
                "body": {"mode": "raw", "raw": "{\"lat\": 12.9716, \"lng\": 77.5946}"},
                "url": "{{gateway_base_url}}/profile/rider/addresses"
              }
            },
            {
              "name": "[P] Delete Address",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 204', () => pm.response.to.have.status(204));"]}}],
              "request": {
                "method": "DELETE",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{gateway_base_url}}/profile/rider/addresses/{{address_id}}"
              }
            }
          ]
        },
        {
          "name": "03.3 - Driver Documents",
          "item": [
            {
              "name": "[P] Get Documents",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "GET",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{gateway_base_url}}/profile/driver/documents"
              }
            },
            {
              "name": "[P] Upload Document",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 201', () => pm.response.to.have.status(201));",
                      "if(pm.response.json().id) pm.collectionVariables.set('document_id', pm.response.json().id);"
                    ]
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Authorization", "value": "Bearer {{auth_token}}"},
                  {"key": "Content-Type", "value": "application/json"}
                ],
                "body": {"mode": "raw", "raw": "{\"type\": \"LICENSE\", \"documentNumber\": \"DL123456\", \"url\": \"https://storage.example.com/doc.pdf\"}"},
                "url": "{{gateway_base_url}}/profile/driver/documents"
              }
            },
            {
              "name": "[N] Upload Document Invalid Type",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Authorization", "value": "Bearer {{auth_token}}"},
                  {"key": "Content-Type", "value": "application/json"}
                ],
                "body": {"mode": "raw", "raw": "{\"type\": \"INVALID_TYPE\", \"documentNumber\": \"DL123456\", \"url\": \"https://example.com/doc.pdf\"}"},
                "url": "{{gateway_base_url}}/profile/driver/documents"
              }
            }
          ]
        },
        {
          "name": "03.4 - Admin Document Management",
          "item": [
            {
              "name": "[P] Approve Document",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Authorization", "value": "Bearer {{admin_token}}"}],
                "url": "{{gateway_base_url}}/profile/admin/driver/{{document_id}}/approve"
              }
            },
            {
              "name": "[P] Reject Document",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]}}],
              "request": {
                "method": "POST",
                "header": [
                  {"key": "Authorization", "value": "Bearer {{admin_token}}"},
                  {"key": "Content-Type", "value": "application/json"}
                ],
                "body": {"mode": "raw", "raw": "{\"reason\": \"Document expired\"}"},
                "url": "{{gateway_base_url}}/profile/admin/driver/{{document_id}}/reject"
              }
            },
            {
              "name": "[N] Approve Without Admin Token",
              "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401 or 403', () => pm.expect([401,403]).to.include(pm.response.code));"]}}],
              "request": {
                "method": "POST",
                "header": [{"key": "Authorization", "value": "Bearer {{auth_token}}"}],
                "url": "{{gateway_base_url}}/profile/admin/driver/{{document_id}}/approve"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "04 - Security Tests",
      "item": [
        {
          "name": "[N] Tampered JWT Signature",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401', () => pm.response.to.have.status(401));"]}}],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImZha2UifQ.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIn0.invalid_signature"}],
            "url": "{{gateway_base_url}}/profile/me"
          }
        },
        {
          "name": "[N] SQL Injection in Username",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400 or 401', () => pm.expect([400,401]).to.include(pm.response.code));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"username\": \"admin'--\", \"password\": \"test\"}"},
            "url": "{{auth_base_url}}/auth/login"
          }
        },
        {
          "name": "[N] XSS in Username",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 400', () => pm.response.to.have.status(400));"]}}],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {"mode": "raw", "raw": "{\"username\": \"<script>alert(1)</script>\", \"password\": \"TestPass123!\"}"},
            "url": "{{auth_base_url}}/auth/register"
          }
        },
        {
          "name": "[N] Missing Content-Type",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 415 or 400', () => pm.expect([400,415]).to.include(pm.response.code));"]}}],
          "request": {
            "method": "POST",
            "header": [],
            "body": {"mode": "raw", "raw": "{\"username\": \"test\", \"password\": \"test123\"}"},
            "url": "{{auth_base_url}}/auth/register"
          }
        },
        {
          "name": "[N] Unsupported HTTP Method",
          "event": [{"listen": "test", "script": {"exec": ["pm.test('Status 405', () => pm.response.to.have.status(405));"]}}],
          "request": {
            "method": "PATCH",
            "header": [],
            "url": "{{auth_base_url}}/auth/login"
          }
        }
      ]
    }
  ]
}
