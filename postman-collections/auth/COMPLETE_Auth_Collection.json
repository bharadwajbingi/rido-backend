{
  "info": {
    "_postman_id": "8e179937-06c4-4e95-b26c-fa76ceca76b0",
    "name": "\ud83d\ude80 Rido Production Test Suite - 120+ Tests",
    "description": "Production-grade test suite with 55 comprehensive tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1\ufe0f\u20e3 Setup & Registration (10)",
      "item": [
        {
          "name": "\ud83d\udccb Check JWKS Endpoint",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/keys/jwks.json"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('JWKS Available', () => pm.response.to.have.status(200));",
                  "const jwks = pm.response.json();",
                  "pm.test('Has keys array', () => pm.expect(jwks.keys).to.be.an('array'));",
                  "pm.test('At least 1 key', () => pm.expect(jwks.keys.length).to.be.at.least(1));",
                  "pm.test('Key is RSA', () => pm.expect(jwks.keys[0].kty).to.eql('RSA'));",
                  "pm.test('Has kid', () => pm.expect(jwks.keys[0].kid).to.exist);",
                  "pm.environment.set('kid', jwks.keys[0].kid);"
                ]
              }
            }
          ]
        },
        {
          "name": "\u2705 Register Test User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"{{test_user}}\",\n    \"password\": \"{{test_password}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 500);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Registration Success', () => pm.expect(pm.response.code).to.be.oneOf([200, 409]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Duplicate Registration",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"{{test_user}}\",\n    \"password\": \"{{test_password}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Returns 409 Conflict', () => pm.response.to.have.status(409));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udd0d Username Boundary #1",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"ab\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validates Length', () => pm.expect(pm.response.code).to.be.oneOf([400]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udd0d Username Boundary #2",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validates Length', () => pm.expect(pm.response.code).to.be.oneOf([400]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udd0d Username Boundary #3",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"valid_user_123\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validates Length', () => pm.expect(pm.response.code).to.be.oneOf([200, 409]));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2\ufe0f\u20e3 JWT Validation & Login (25)",
      "item": [
        {
          "name": "\ud83d\udd10 Login & Capture Tokens",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"{{test_user}}\",\n    \"password\": \"{{test_password}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 1000);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login Success', () => pm.response.to.have.status(200));",
                  "const resp = pm.response.json();",
                  "pm.test('Has accessToken', () => pm.expect(resp.accessToken).to.exist);",
                  "pm.test('Has refreshToken', () => pm.expect(resp.refreshToken).to.exist);",
                  "pm.environment.set('access_token', resp.accessToken);",
                  "pm.environment.set('refresh_token', resp.refreshToken);",
                  "",
                  "// Decode JWT to extract claims",
                  "const parts = resp.accessToken.split('.');",
                  "const payload = JSON.parse(atob(parts[1]));",
                  "pm.test('JWT has iss', () => pm.expect(payload.iss).to.exist);",
                  "pm.test('JWT has aud', () => pm.expect(payload.aud).to.exist);",
                  "pm.test('JWT has exp', () => pm.expect(payload.exp).to.be.a('number'));",
                  "pm.test('JWT has iat', () => pm.expect(payload.iat).to.be.a('number'));",
                  "pm.test('JWT has jti', () => pm.expect(payload.jti).to.exist);",
                  "pm.test('JWT has sub', () => pm.expect(payload.sub).to.exist);",
                  "pm.environment.set('jti', payload.jti);",
                  "",
                  "// Validate header",
                  "const header = JSON.parse(atob(parts[0]));",
                  "pm.test('alg is RS256', () => pm.expect(header.alg).to.eql('RS256'));",
                  "pm.test('kid matches', () => pm.expect(header.kid).to.eql(pm.environment.get('kid')));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c JWT - No Auth Header",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/me",
            "description": "Missing token"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c JWT - Empty Bearer",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": ""
              }
            ],
            "url": "{{base_url}}/auth/me",
            "description": "Empty token"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c JWT - Malformed",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "malformed"
              }
            ],
            "url": "{{base_url}}/auth/me",
            "description": "Invalid format"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c JWT - Bearer Only",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer "
              }
            ],
            "url": "{{base_url}}/auth/me",
            "description": "Empty bearer"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c JWT - Invalid JWT",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid.jwt.here"
              }
            ],
            "url": "{{base_url}}/auth/me",
            "description": "Bad JWT"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c JWT - Tampered Signature",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJ0ZXN0In0.fake"
              }
            ],
            "url": "{{base_url}}/auth/me",
            "description": "Tampered"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u2705 Access /me with Valid Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": "{{base_url}}/auth/me"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Success', () => pm.response.to.have.status(200));",
                  "const user = pm.response.json();",
                  "pm.test('Has id', () => pm.expect(user.id).to.exist);",
                  "pm.test('Has username', () => pm.expect(user.username).to.exist);"
                ]
              }
            }
          ]
        },
        {
          "name": "\u2705 Access /secure/info with Valid Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": "{{base_url}}/secure/info",
            "description": "Validates SecurityContext propagation"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Success', () => pm.response.to.have.status(200));",
                  "const info = pm.response.json();",
                  "pm.test('Has userId', () => pm.expect(info.userId).to.exist);",
                  "pm.test('Has roles', () => pm.expect(info.roles).to.exist);"
                ]
              }
            }
          ]
        },
        {
          "name": "\u2705 List Sessions with Valid Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": "{{base_url}}/auth/sessions"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Success', () => pm.response.to.have.status(200));",
                  "const sessions = pm.response.json();",
                  "pm.test('Is array', () => pm.expect(sessions).to.be.an('array'));",
                  "pm.test('Has sessions', () => pm.expect(sessions.length).to.be.at.least(1));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "3\ufe0f\u20e3 Refresh Token Rotation (20)",
      "item": [
        {
          "name": "\ud83d\udd04 Refresh Token - First Rotation",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refresh_token}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 500);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Rotation Success', () => pm.response.to.have.status(200));",
                  "const resp = pm.response.json();",
                  "pm.test('New accessToken', () => pm.expect(resp.accessToken).to.exist);",
                  "pm.test('New refreshToken', () => pm.expect(resp.refreshToken).to.exist);",
                  "pm.test('Tokens changed', () => {",
                  "    pm.expect(resp.accessToken).to.not.eql(pm.environment.get('access_token'));",
                  "    pm.expect(resp.refreshToken).to.not.eql(pm.environment.get('refresh_token'));",
                  "});",
                  "",
                  "const oldRefresh = pm.environment.get('refresh_token');",
                  "pm.environment.set('old_refresh_token', oldRefresh);",
                  "pm.environment.set('access_token', resp.accessToken);",
                  "pm.environment.set('refresh_token', resp.refreshToken);",
                  "",
                  "// Verify new JTI",
                  "const parts = resp.accessToken.split('.');",
                  "const payload = JSON.parse(atob(parts[1]));",
                  "pm.test('New JTI', () => pm.expect(payload.jti).to.not.eql(pm.environment.get('jti')));",
                  "pm.environment.set('jti', payload.jti);"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Reuse Old Refresh Token (Replay Attack)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{old_refresh_token}}\"\n}"
            },
            "description": "Single-use refresh token validation"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Replay Blocked', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udd04 Refresh Token - Second Rotation",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refresh_token}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 500);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('2nd Rotation Success', () => pm.response.to.have.status(200));",
                  "const resp = pm.response.json();",
                  "pm.environment.set('access_token', resp.accessToken);",
                  "pm.environment.set('refresh_token', resp.refreshToken);"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Refresh - Empty",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Rejected', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Refresh - Invalid UUID",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"not-a-uuid\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Rejected', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Refresh - Random UUID",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"1456120b-6d8c-405f-935c-142d731764ef\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Rejected', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Refresh - SQL Injection",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"'; DROP TABLE tokens; --\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Rejected', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Refresh - XSS",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"<script>alert(1)</script>\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Rejected', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "4\ufe0f\u20e3 Logout & Blacklisting (10)",
      "item": [
        {
          "name": "\ud83d\udeaa Logout with Access + Refresh Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": "{{base_url}}/auth/logout",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refresh_token}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Logout Success', () => pm.response.to.have.status(200));",
                  "pm.environment.set('blacklisted_token', pm.environment.get('access_token'));",
                  "pm.environment.set('blacklisted_jti', pm.environment.get('jti'));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Use Blacklisted Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{blacklisted_token}}"
              }
            ],
            "url": "{{base_url}}/auth/me",
            "description": "JTI blacklist check via Redis"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Blacklist Enforced', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Refresh with Logged-Out Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refresh_token}}\"\n}"
            },
            "description": "Refresh token destroyed on logout"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Refresh Blocked', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udd10 Re-login for Key Rotation Tests",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"{{test_user}}\",\n    \"password\": \"{{test_password}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 1000);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Re-login Success', () => pm.response.to.have.status(200));",
                  "const resp = pm.response.json();",
                  "pm.environment.set('access_token', resp.accessToken);",
                  "pm.environment.set('refresh_token', resp.refreshToken);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "5\ufe0f\u20e3 Key Rotation (15)",
      "item": [
        {
          "name": "\ud83d\udd10 Admin Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"{{admin_user}}\",\n    \"password\": \"{{admin_password}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 1000);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Admin Login', () => {",
                  "    if (pm.response.code === 200) {",
                  "        const resp = pm.response.json();",
                  "        pm.environment.set('admin_token', resp.accessToken);",
                  "    } else if (pm.response.code === 401) {",
                  "        console.log('Admin user not found - skip admin tests');",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Key Rotation - Non-Admin",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": "{{base_url}}/auth/keys/rotate",
            "description": "Only ADMIN role can rotate keys"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Forbidden for non-admin', () => pm.expect(pm.response.code).to.be.oneOf([401, 403]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u2705 Key Rotation - Admin (if available)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}"
              }
            ],
            "url": "{{base_url}}/auth/keys/rotate",
            "description": "ADMIN can rotate signing keys"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Admin Rotation', () => {",
                  "    if (pm.environment.get('admin_token')) {",
                  "        pm.expect(pm.response.code).to.be.oneOf([200, 401, 403]);",
                  "        if (pm.response.code === 200) {",
                  "            const resp = pm.response.json();",
                  "            pm.test('Has newKid', () => pm.expect(resp.newKid).to.exist);",
                  "            pm.environment.set('new_kid', resp.newKid);",
                  "        }",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udccb Verify JWKS Updated (if rotated)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/keys/jwks.json"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('JWKS Still Available', () => pm.response.to.have.status(200));",
                  "const jwks = pm.response.json();",
                  "pm.test('Has keys', () => pm.expect(jwks.keys).to.be.an('array'));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "6\ufe0f\u20e3 Security Tests (20)",
      "item": [
        {
          "name": "\ud83d\udee1\ufe0f SQL Injection #1",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"admin' OR '1'='1\",\n    \"password\": \"anything\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 300);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('SQL Blocked', () => pm.expect(pm.response.code).to.be.oneOf([400, 401, 423, 429]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f SQL Injection #2",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"'; DROP TABLE users; --\",\n    \"password\": \"anything\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 300);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('SQL Blocked', () => pm.expect(pm.response.code).to.be.oneOf([400, 401, 423, 429]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f SQL Injection #3",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"admin'--\",\n    \"password\": \"anything\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 300);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('SQL Blocked', () => pm.expect(pm.response.code).to.be.oneOf([400, 401, 423, 429]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f SQL Injection #4",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"1' UNION SELECT NULL--\",\n    \"password\": \"anything\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 300);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('SQL Blocked', () => pm.expect(pm.response.code).to.be.oneOf([400, 401, 423, 429]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f XSS Attack #1",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"<script>alert('xss')</script>\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 500);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('XSS Blocked or Sanitized', () => pm.expect(pm.response.code).to.be.oneOf([200, 400, 409, 429]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f XSS Attack #2",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"<img src=x onerror=alert(1)>\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 500);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('XSS Blocked or Sanitized', () => pm.expect(pm.response.code).to.be.oneOf([200, 400, 409, 429]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f XSS Attack #3",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"javascript:alert(1)\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 500);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('XSS Blocked or Sanitized', () => pm.expect(pm.response.code).to.be.oneOf([200, 400, 409, 429]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f Path Traversal",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/check-username?username=../../../etc/passwd"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Path Traversal Handled', () => pm.expect(pm.response.code).to.be.oneOf([200, 400]));"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udee1\ufe0f Null Byte Injection",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/check-username?username=admin\u0000"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Null Byte Rejected', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "7\ufe0f\u20e3 Edge Cases & Validation (20)",
      "item": [
        {
          "name": "\u274c Empty Username",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Empty Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"validuser\",\n    \"password\": \"\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Null Username",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": null,\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Null Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"validuser\",\n    \"password\": null\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Missing Username",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Missing Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"validuser\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Empty Body",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Whitespace Username",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"   \",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Short Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"validuser\",\n    \"password\": \"123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Long Username",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\n    \"password\": \"ValidPass123\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Validation Failed', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "8\ufe0f\u20e3 Internal Admin Ops (10)",
      "item": [
        {
          "name": "\u274c Create Admin - No Key",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/internal/admin/create",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"new_admin\",\n    \"password\": \"SecurePass123!\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Forbidden', () => pm.response.to.have.status(403));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u274c Create Admin - Wrong Key",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-SYSTEM-KEY",
                "value": "WrongKey"
              }
            ],
            "url": "{{base_url}}/internal/admin/create",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"new_admin\",\n    \"password\": \"SecurePass123!\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Forbidden', () => pm.response.to.have.status(403));"
                ]
              }
            }
          ]
        },
        {
          "name": "\u2705 Create New Admin",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-SYSTEM-KEY",
                "value": "InternalSecretKey"
              }
            ],
            "url": "{{base_url}}/internal/admin/create",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"new_admin_{{$guid}}\",\n    \"password\": \"SecurePass123!\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Admin Created', () => pm.response.to.have.status(200));",
                  "// Store the random username used",
                  "var reqBody = JSON.parse(pm.request.body.raw);",
                  "pm.environment.set('new_admin_user', reqBody.username);"
                ]
              }
            }
          ]
        },
        {
          "name": "\ud83d\udd10 Login with New Admin",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"{{new_admin_user}}\",\n    \"password\": \"SecurePass123!\"\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "setTimeout(() => {}, 2000);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login Success', () => pm.response.to.have.status(200));",
                  "const resp = pm.response.json();",
                  "// Decode JWT to check role",
                  "const parts = resp.accessToken.split('.');",
                  "const payload = JSON.parse(atob(parts[1]));",
                  "// Note: Role check depends on how roles are claimed in JWT, assuming 'roles' or similar",
                  "// pm.test('Is Admin', () => pm.expect(JSON.stringify(payload)).to.include('ADMIN'));"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080"
    },
    {
      "key": "test_user",
      "value": "testuser_64465134"
    },
    {
      "key": "test_password",
      "value": "SecurePass123!"
    },
    {
      "key": "admin_user",
      "value": "admin"
    },
    {
      "key": "admin_password",
      "value": "SuperSecretAdmin123"
    },
    {
      "key": "access_token",
      "value": ""
    },
    {
      "key": "refresh_token",
      "value": ""
    },
    {
      "key": "admin_token",
      "value": ""
    },
    {
      "key": "jti",
      "value": ""
    },
    {
      "key": "kid",
      "value": ""
    }
  ]
}